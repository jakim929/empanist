{"version":3,"sources":["meteor://ðŸ’»app/packages/easysearch:core/lib/core/index.js","meteor://ðŸ’»app/packages/easysearch:core/lib/core/engine.js","meteor://ðŸ’»app/packages/easysearch:core/lib/core/reactive-engine.js","meteor://ðŸ’»app/packages/easysearch:core/lib/core/cursor.js","meteor://ðŸ’»app/packages/easysearch:core/lib/core/search-collection.js","meteor://ðŸ’»app/packages/easysearch:core/lib/engines/mongo-db.js","meteor://ðŸ’»app/packages/easysearch:core/lib/engines/minimongo.js","meteor://ðŸ’»app/packages/easysearch:core/lib/engines/mongo-text-index.js","meteor://ðŸ’»app/packages/easysearch:core/lib/globals.js"],"names":[],"mappings":"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","file":"/packages/easysearch_core.js","sourcesContent":["/**\n * An Index represents the main entry point for searching with EasySearch. It relies on\n * the given engine to have the search functionality and defines the data that should be searchable.\n *\n * @type {Index}\n */\nIndex = class Index {\n  /**\n   * Constructor\n   *\n   * @param {Object} config Configuration\n   *\n   * @constructor\n   */\n  constructor(config) {\n    check(config, Object);\n    check(config.collection, Meteor.Collection);\n    check(config.fields, [String]);\n\n    if (!(config.engine instanceof Engine)) {\n      throw new Meteor.Error('invalid-engine', 'engine needs to be instanceof Engine');\n    }\n\n    if (!config.name)\n      config.name = (config.collection._name || '').toLowerCase();\n\n    this.config = _.extend(Index.defaultConfiguration, config);\n    this.defaultSearchOptions = _.defaults({}, this.config.defaultSearchOptions, { limit: 10, skip: 0, props: {} });\n\n    // Engine specific code on index creation\n    config.engine.onIndexCreate(this.config);\n  }\n\n  /**\n   * Default configuration for an index.\n   *\n   * @returns {Object}\n   */\n  static get defaultConfiguration() {\n    return {\n      permission: () => true,\n      defaultSearchOptions: {}\n    };\n  }\n\n  /**\n   * Search the index.\n   *\n   * @param {Object|String} searchDefinition Search definition\n   * @param {Object}        options          Options\n   *\n   * @returns {Cursor}\n   */\n  search(searchDefinition, options = {}) {\n    this.config.engine.checkSearchParam(searchDefinition, this.config);\n\n    check(options, {\n      limit: Match.Optional(Number),\n      skip: Match.Optional(Number),\n      props: Match.Optional(Object)\n    });\n\n    options = {\n      search: this._getSearchOptions(options),\n      index: this.config\n    };\n\n    if (!this.config.permission(options.search)) {\n      throw new Meteor.Error('not-allowed', \"Not allowed to search this index!\");\n    }\n\n    return this.config.engine.search(searchDefinition, options);\n  }\n\n  /**\n   * Returns the search options based on the given options.\n   *\n   * @param {Object} options Options to use\n   *\n   * @returns {Object}\n   */\n  _getSearchOptions(options) {\n    return _.defaults(( Meteor.userId ? { userId: Meteor.userId() } : {} ), options, this.defaultSearchOptions);\n  }\n};\n","/**\n * An Engine is the technology used for searching with EasySearch, with\n * customizable configuration to how it interacts with the data from the Index.\n *\n * @type {Engine}\n */\nEngine = class Engine {\n  /**\n   * Constructor\n   *\n   * @param {Object} config configuration\n   *\n   * @constructor\n   */\n  constructor(config = {}) {\n    if (this.constructor === Engine) {\n      throw new Error('Cannot initialize instance of Engine');\n    }\n\n    if (!_.isFunction(this.search)) {\n      throw new Error('Engine needs to implement search method');\n    }\n\n    this.config = _.defaults({}, config, this.defaultConfiguration());\n  }\n\n  /**\n   * Return default configuration.\n   *\n   * @returns {Object}\n   */\n  defaultConfiguration() {\n    return {};\n  }\n\n  /**\n   * Call a configuration method with the engine scope.\n   *\n   * @param {String} methodName Method name\n   * @param {Object} args       Arguments for the method\n   *\n   * @returns {*}\n   */\n  callConfigMethod(methodName, ...args) {\n    check(methodName, String);\n\n    let func = this.config[methodName];\n\n    if (func) {\n      return func.apply(this, args);\n    }\n  }\n\n  /**\n   * Check the given search parameter for validity\n   *\n   * @param search\n   */\n  checkSearchParam(search) {\n    check(search, String);\n  }\n\n  /**\n   *Code to run on index creation\n   *\n   * @param {Object} indexConfig Index configuraction\n   */\n  onIndexCreate(indexConfig) {\n    if (!indexConfig.allowedFields) {\n      indexConfig.allowedFields = indexConfig.fields;\n    }\n  }\n};\n","/**\n * A ReactiveEngine handles the reactive logic, such as subscribing\n * and publishing documents into a self contained collection.\n *\n * @type {ReactiveEngine}\n */\nReactiveEngine = class ReactiveEngine extends Engine {\n  /**\n   * Constructor.\n   *\n   * @param {Object} config Configuration\n   *\n   * @constructor\n   */\n  constructor(config) {\n    super(config);\n\n    if (this === this.constructor) {\n      throw new Error('Cannot initialize instance of ReactiveEngine');\n    }\n\n    if (!_.isFunction(this.getSearchCursor)) {\n      throw new Error('Reactive engine needs to implement getSearchCursor method');\n    }\n  }\n\n  /**\n   * Return default configuration.\n   *\n   * @returns {Object}\n   */\n  defaultConfiguration() {\n    return _.defaults({}, {\n      transform: (doc) => doc,\n      beforePublish: (event, doc) => doc\n    }, super.defaultConfiguration());\n  }\n\n  /**\n   * Code to run on index creation\n   *\n   * @param {Object} indexConfig Index configuration\n   */\n  onIndexCreate(indexConfig) {\n    super.onIndexCreate(indexConfig);\n    indexConfig.searchCollection = new SearchCollection(indexConfig, this);\n    indexConfig.mongoCollection = indexConfig.searchCollection._collection;\n  }\n\n  /**\n   * Transform the search definition.\n   *\n   * @param {String|Object} searchDefinition Search definition\n   * @param {Object}        options          Search and index options\n   *\n   * @returns {Object}\n   */\n  transformSearchDefinition(searchDefinition, options) {\n    if (_.isString(searchDefinition)) {\n      let obj = {};\n\n      _.each(options.index.fields, function (field) {\n        obj[field] = searchDefinition;\n      });\n\n      searchDefinition = obj;\n    }\n\n    return searchDefinition;\n  }\n\n  /**\n   * Check the given search parameter for validity\n   *\n   * @param search\n   * @param indexOptions\n   */\n  checkSearchParam(search, indexOptions) {\n    check(search, Match.OneOf(String, Object));\n\n    if (_.isObject(search)) {\n      _.each(search, function (val, field) {\n        check(val, String);\n\n        if (-1 === _.indexOf(indexOptions.allowedFields, field)) {\n          throw new Meteor.Error(`Not allowed to search over field \"${field}\"`);\n        }\n      });\n    }\n  }\n\n  /**\n   * Reactively search on the collection.\n   *\n   * @param {Object} searchDefinition Search definition\n   * @param {Object} options          Options\n   *\n   * @returns {Cursor}\n   */\n  search(searchDefinition, options) {\n    if (Meteor.isClient) {\n      return options.index.searchCollection.find(searchDefinition, options.search);\n    } else {\n      return this.getSearchCursor(\n        this.transformSearchDefinition(searchDefinition, options),\n        options\n      );\n    }\n  }\n};\n","/**\n * A Cursor represents a pointer to the search results. Since it's specific\n * to EasySearch it can also be used to check for valid return values.\n *\n * @type {Cursor}\n */\nCursor = class Cursor {\n  /**\n   * Constructor\n   *\n   * @param {Mongo.Cursor} mongoCursor   Referenced mongo cursor\n   * @param {Number}       count         Count of all documents found\n   * @param {Boolean}      isReady       Cursor is ready\n   * @param {Object}       publishHandle Publish handle to stop if on client\n   *\n   * @constructor\n   *\n   */\n  constructor(mongoCursor, count, isReady = true, publishHandle = null) {\n    check(mongoCursor.fetch, Function);\n    check(count, Number);\n    check(isReady, Match.Optional(Boolean));\n    check(publishHandle, Match.OneOf(null, Object));\n\n    this._mongoCursor = mongoCursor;\n    this._count = count;\n    this._isReady = isReady;\n    this._publishHandle = publishHandle;\n  }\n\n  /**\n   * Fetch the search results.\n   *\n   * @returns {[Object]}\n   */\n  fetch() {\n    return this._mongoCursor.fetch();\n  }\n\n /**\n  * Stop the subscription handle associated with the cursor.\n  */\n  stop() {\n    if (this._publishHandle) {\n      return this._publishHandle.stop();\n    }\n  }\n\n  /**\n   * Return count of all documents found\n   *\n   * @returns {Number}\n   */\n  count() {\n    return this._count;\n  }\n\n  /**\n   * Return if the cursor is ready.\n   *\n   * @returns {Boolean}\n   */\n  isReady() {\n    return this._isReady;\n  }\n\n  /**\n   * Return the raw mongo cursor.\n   *\n   * @returns {Mongo.Cursor}\n   */\n  get mongoCursor() {\n    return this._mongoCursor;\n  }\n\n  /**\n   * Return a fake empty cursor, without data.\n   *\n   * @returns {Object}\n   */\n  static get emptyCursor() {\n    return { fetch: () => [], observe: () => { return { stop: () => null }; }, stop: () => {} };\n  }\n};\n","/**\n * A search collection represents a reactive collection on the client,\n * which is used by the ReactiveEngine for searching.\n *\n * @type {SearchCollection}\n */\nSearchCollection = class SearchCollection {\n  /**\n   * Constructor\n   *\n   * @param {Object}         indexConfiguration Index configuration\n   * @param {ReactiveEngine} engine             Reactive Engine\n   *\n   * @constructor\n   */\n  constructor(indexConfiguration, engine) {\n    check(indexConfiguration, Object);\n    check(indexConfiguration.name, Match.OneOf(String, null));\n\n    if (!(engine instanceof ReactiveEngine)) {\n      throw new Meteor.Error('invalid-engine', 'engine needs to be instanceof ReactiveEngine');\n    }\n\n    this._indexConfiguration = indexConfiguration;\n    this._name = `${indexConfiguration.name}/easySearch`;\n    this._engine = engine;\n\n    if (Meteor.isClient) {\n      this._collection = new Meteor.Collection(this._name);\n    } else if (Meteor.isServer) {\n      this._setUpPublication();\n    }\n  }\n\n  /**\n   * Get name\n   *\n   * @returns {String}\n   */\n  get name() {\n    return this._name;\n  }\n\n  /**\n   * Get engine\n   *\n   * @returns {ReactiveEngine}\n   */\n  get engine() {\n    return this._engine;\n  }\n\n  /**\n   * Find documents on the client.\n   *\n   * @param {Object} searchDefinition Search definition\n   * @param {Object} options          Options\n   *\n   * @returns {Cursor}\n   */\n  find(searchDefinition, options) {\n    if (!Meteor.isClient) {\n      throw new Error('find can only be used on client');\n    }\n\n    let publishHandle = Meteor.subscribe(this.name, searchDefinition, options);\n\n    let count = this._getCount(searchDefinition);\n    let mongoCursor = this._getMongoCursor(searchDefinition, options);\n\n    if (!_.isNumber(count)) {\n      return new Cursor(mongoCursor, 0, false);\n    }\n\n    return new Cursor(mongoCursor, count, true, publishHandle);\n  }\n\n  /**\n   * Get the count of the cursor.\n   *\n   * @params {Object} searchDefinition Search definition\n   *\n   * @returns {Cursor.count}\n   *\n   * @private\n   */\n  _getCount(searchDefinition) {\n    let countDoc = this._collection.findOne('searchCount' + JSON.stringify(searchDefinition));\n\n    if (countDoc) {\n      return countDoc.count;\n    }\n  }\n\n  /**\n   * Get the mongo cursor.\n   *\n   * @param {Object} searchDefinition Search definition\n   * @param {Object} options          Search options\n   *\n   * @returns {Cursor}\n   * @private\n   */\n  _getMongoCursor(searchDefinition, options) {\n    return this._collection.find(\n      { __searchDefinition: JSON.stringify(searchDefinition), __searchOptions: JSON.stringify(options.props) },\n      {\n        transform: (doc) => {\n          delete doc.__searchDefinition;\n          delete doc.__searchOptions;\n          delete doc.__sortPosition;\n\n          doc = this.engine.config.transform(doc);\n\n          return doc;\n        },\n        sort: ['__sortPosition']\n      }\n    );\n  }\n\n  /**\n   * Return a unique document id for publication.\n   *\n   * @param {Document} doc\n   *\n   * @returns string\n   */\n  generateId(doc) {\n    return doc._id + doc.__searchDefinition + doc.__searchOptions;\n  }\n\n  /**\n   * Add custom fields to the given document\n   *\n   * @param {Document} doc\n   * @param {Object}   data\n   * @returns {*}\n   */\n  addCustomFields(doc, data) {\n    _.forEach(data, function (val, key) {\n      doc['__' + key] = val;\n    });\n\n    return doc;\n  }\n\n  /**\n   * Set up publication.\n   *\n   * @private\n   */\n  _setUpPublication() {\n    var collectionScope = this,\n      collectionName = this.name;\n\n    Meteor.publish(collectionName, function (searchDefinition, options) {\n      check(searchDefinition, Match.OneOf(String, Object));\n      check(options, Object);\n\n      let definitionString = JSON.stringify(searchDefinition),\n        optionsString = JSON.stringify(options.props);\n\n      options.userId = this.userId;\n      options.publicationScope = this;\n\n      if (!collectionScope._indexConfiguration.permission(options)) {\n        throw new Meteor.Error('not-allowed', \"You're not allowed to search this index!\");\n      }\n\n      collectionScope.engine.checkSearchParam(searchDefinition, collectionScope._indexConfiguration);\n\n      let cursor = collectionScope.engine.search(searchDefinition, {\n        search: options,\n        index: collectionScope._indexConfiguration\n      });\n\n      const count = cursor.count();\n\n      this.added(collectionName, 'searchCount' + definitionString, { count: count });\n\n      let resultsHandle = cursor.mongoCursor.observe({\n        addedAt: (doc, atIndex, before) => {\n          doc = collectionScope.engine.config.beforePublish('addedAt', doc, atIndex, before);\n          doc = collectionScope.addCustomFields(doc, {\n            searchDefinition: definitionString,\n            searchOptions: optionsString,\n            sortPosition: atIndex,\n            originalId: doc._id\n          });\n\n          this.added(collectionName, collectionScope.generateId(doc), doc);\n        },\n        changedAt: (doc, oldDoc, atIndex) => {\n          doc = collectionScope.engine.config.beforePublish('changedAt', doc, oldDoc, atIndex);\n          doc = collectionScope.addCustomFields(doc, {\n            searchDefinition: definitionString,\n            searchOptions: optionsString,\n            sortPosition: atIndex,\n            originalId: doc._id\n          });\n\n          this.changed(collectionName, collectionScope.generateId(doc), doc)\n        },\n        movedTo: (doc, fromIndex, toIndex, before) => {\n          doc = collectionScope.engine.config.beforePublish('movedTo', doc, fromIndex, toIndex, before);\n          doc = collectionScope.addCustomFields(doc, {\n            searchDefinition: definitionString,\n            searchOptions: optionsString,\n            sortPosition: toIndex\n          });\n\n          let beforeDoc = collectionScope._indexConfiguration.collection.findOne(before);\n\n          if (beforeDoc) {\n            beforeDoc = collectionScope.addCustomFields(beforeDoc, {\n              searchDefinition: definitionString,\n              searchOptions: optionsString,\n              sortPosition: fromIndex\n            });\n            this.changed(collectionName, collectionScope.generateId(beforeDoc), beforeDoc);\n          }\n\n          this.changed(collectionName, collectionScope.generateId(doc), doc);\n        },\n        removedAt: (doc, atIndex) => {\n          doc = collectionScope.engine.config.beforePublish('removedAt', doc, atIndex);\n          doc = collectionScope.addCustomFields(doc, { searchDefinition: definitionString, searchOptions: optionsString });\n          this.removed(collectionName, collectionScope.generateId(doc));\n        }\n      });\n\n      this.onStop(function () {\n        resultsHandle.stop();\n      });\n\n      this.ready();\n    });\n  }\n};\n","/**\n * The MongoDBEngine lets you search the index on the server side with MongoDB. Subscriptions and publications\n * are handled within the Engine.\n *\n * @type {MongoDBEngine}\n */\nMongoDBEngine = class MongoDBEngine extends ReactiveEngine {\n  /**\n   * Return default configuration.\n   *\n   * @returns {Object}\n   */\n  defaultConfiguration() {\n    return _.defaults({}, MongoDBEngine.defaultMongoConfiguration(this), super.defaultConfiguration());\n  }\n\n  /**\n   * Default mongo configuration, used in constructor and MinimongoEngine to get the configuration.\n   *\n   * @param {Object} engineScope Scope of the engine\n   *\n   * @returns {Object}\n   */\n  static defaultMongoConfiguration(engineScope) {\n    return {\n      aggregation: '$or',\n      selector(searchObject, options, aggregation) {\n        let selector = {};\n\n        selector[aggregation] = [];\n\n        _.each(searchObject, (searchString, field) => {\n          let fieldSelector = engineScope.callConfigMethod(\n            'selectorPerField', field, searchString, options\n          );\n\n          if (fieldSelector) {\n            selector[aggregation].push(fieldSelector);\n          }\n        });\n\n        return selector;\n      },\n      selectorPerField(field, searchString) {\n        let selector = {};\n\n        selector[field] = { '$regex' : `.*${searchString}.*`, '$options' : 'i'};\n\n        return selector\n      },\n      sort(searchObject, options) {\n        return options.index.fields;\n      }\n    };\n  }\n\n  /**\n   * Return the find options for the mongo find query.\n   *\n   * @param {String} searchDefinition Search definition\n   * @param {Object} options          Search and index options\n   */\n  getFindOptions(searchDefinition, options) {\n    return {\n      sort: this.callConfigMethod('sort', searchDefinition, options),\n      limit: options.search.limit,\n      skip: options.search.skip,\n      fields: this.callConfigMethod('fields', searchDefinition, options)\n    };\n  }\n\n  /**\n   * Return the reactive search cursor.\n   *\n   * @param {String} searchDefinition Search definition\n   * @param {Object} options          Search and index options\n   */\n  getSearchCursor(searchDefinition, options) {\n    let selector = this.callConfigMethod('selector', searchDefinition, options, this.config.aggregation),\n      findOptions = this.getFindOptions(searchDefinition, options),\n      collection = options.index.collection;\n\n    check(options, Object);\n    check(selector, Object);\n    check(findOptions, Object);\n\n    return new Cursor(\n      collection.find(selector, findOptions),\n      collection.find(selector).count()\n    );\n  }\n};\n","/**\n * The MinimongEngine lets you search the index on the client-side.\n *\n * @type {MinimongoEngine}\n */\nMinimongoEngine = class MinimongoEngine extends Engine {\n  /**\n   * Return default configuration.\n   *\n   * @returns {Object}\n   */\n  defaultConfiguration() {\n    return _.defaults({}, MongoDBEngine.defaultMongoConfiguration(this), super.defaultConfiguration());\n  }\n\n  /**\n   * Search the index.\n   *\n   * @param {Object} searchDefinition Search definition\n   * @param {Object} options          Object of options\n   *\n   * @returns {cursor}\n   */\n  search(searchDefinition, options) {\n    if (!Meteor.isClient) {\n      throw new Meteor.Error('only-client', 'Minimongo can only be used on the client');\n    }\n\n    searchDefinition = this.transformSearchDefinition(searchDefinition, options);\n\n    // check() calls are in getSearchCursor method\n    return MongoDBEngine.prototype.getSearchCursor.apply(this, [searchDefinition, options]);\n  }\n};\n\nMinimongoEngine.prototype.checkSearchParam = ReactiveEngine.prototype.checkSearchParam;\nMinimongoEngine.prototype.transformSearchDefinition = ReactiveEngine.prototype.transformSearchDefinition;\n\nMinimongoEngine.prototype.getFindOptions = function (...args) {\n  let findOptions = MongoDBEngine.prototype.getFindOptions.apply(this, args);\n\n  findOptions.transform = this.config.transform;\n\n  return findOptions;\n};\n","/**\n * The MongoTextIndexEngine lets you search the index with Mongo text indexes.\n *\n * @type {MongoTextIndexEngine}\n */\nMongoTextIndexEngine = class MongoTextIndexEngine extends ReactiveEngine {\n  /**\n   * Return default configuration.\n   *\n   * @returns {Object}\n   */\n  defaultConfiguration() {\n    let mongoConfiguration = MongoDBEngine.defaultMongoConfiguration(this);\n\n    mongoConfiguration.selector = function (searchString) {\n      if (searchString.trim()) {\n        return { $text: { $search: searchString } };\n      }\n\n      return {};\n    };\n\n    return _.defaults({}, mongoConfiguration, super.defaultConfiguration());\n  }\n\n  /**\n   * Setup the index on creation.\n   *\n   * @param {Object} indexConfig Index configuration\n   */\n  onIndexCreate(indexConfig) {\n    super.onIndexCreate(indexConfig);\n\n    if (Meteor.isServer) {\n      let textIndexesConfig = {};\n\n      _.each(indexConfig.fields, function (field) {\n        textIndexesConfig[field] = 'text';\n      });\n\n      if (indexConfig.weights) {\n        textIndexesConfig.weights = options.weights();\n      }\n\n      indexConfig.collection._ensureIndex(textIndexesConfig);\n    }\n  }\n\n  /**\n   * Transform the search definition.\n   *\n   * @param {String|Object} searchDefinition Search definition\n   * @param {Object}        options          Search and index options\n   *\n   * @returns {Object}\n   */\n  transformSearchDefinition(searchDefinition, options) {\n    return searchDefinition;\n  }\n\n  /**\n   * Check the given search parameter for validity\n   *\n   * @param search\n   */\n  checkSearchParam(search) {\n    check(search, String);\n  }\n};\n\n// Explicitely inherit getSearchCursor method functionality\nMongoTextIndexEngine.prototype.getSearchCursor = MongoDBEngine.prototype.getSearchCursor;\nMongoTextIndexEngine.prototype.getFindOptions = MongoDBEngine.prototype.getFindOptions;\n","EasySearch = {\n  // Core\n  Index,\n  Engine,\n  ReactiveEngine,\n  Cursor,\n  // Engines\n  MongoDB: MongoDBEngine,\n  Minimongo: MinimongoEngine,\n  MongoTextIndex: MongoTextIndexEngine\n};\n"]}
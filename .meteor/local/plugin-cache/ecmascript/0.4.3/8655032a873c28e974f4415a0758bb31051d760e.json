{"metadata":{"usedHelpers":[],"marked":[],"modules":{"imports":[{"source":"meteor/meteor","imported":["Meteor"],"specifiers":[{"kind":"named","imported":"Meteor","local":"Meteor"}]},{"source":"../collections/basicProfiles.js","imported":["BasicProfiles"],"specifiers":[{"kind":"named","imported":"BasicProfiles","local":"BasicProfiles"}]},{"source":"../collections/musicProfiles.js","imported":["MusicProfiles"],"specifiers":[{"kind":"named","imported":"MusicProfiles","local":"MusicProfiles"}]},{"source":"../collections/accompanistProfiles.js","imported":["AccompanistProfiles"],"specifiers":[{"kind":"named","imported":"AccompanistProfiles","local":"AccompanistProfiles"}]}],"exports":{"exported":[],"specifiers":[]}}},"options":{"filename":"/server/main.js","filenameRelative":"/server/main.js","env":{},"retainLines":false,"highlightCode":true,"suppressDeprecationMessages":false,"presets":[],"plugins":[[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"polyfill":false}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],{"loose":true}],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],{"allowTopLevelThis":true,"strict":false,"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null]],"ignore":[],"code":true,"metadata":true,"ast":false,"comments":true,"compact":false,"minified":false,"sourceMap":true,"sourceMaps":true,"sourceMapTarget":"/server/main.js.map","sourceFileName":"/server/main.js","babelrc":false,"sourceType":"module","moduleIds":false,"passPerPreset":false,"basename":"main"},"ignored":false,"code":"var _meteor = require('meteor/meteor');\n\nvar _basicProfiles = require('../collections/basicProfiles.js');\n\nvar _musicProfiles = require('../collections/musicProfiles.js');\n\nvar _accompanistProfiles = require('../collections/accompanistProfiles.js');\n\n_meteor.Meteor.startup(function () {});\n\nvar geo = new GeoCoder();\n\ngetGeocode = function getGeocode(arg) {\n  var result = geo.geocode(arg);\n  return result;\n};\n\n_meteor.Meteor.methods({\n  getGeocode: function () {\n    function getGeocode(arg) {\n      var result = geo.geocode(arg);\n      return result;\n    }\n\n    return getGeocode;\n  }(),\n\n  insertFullRandomProfile: function () {\n    function insertFullRandomProfile(userId) {\n      _basicProfiles.BasicProfiles.insert(createNewBasicProfile(userId), { getAutoValues: false });\n      _musicProfiles.MusicProfiles.insert(createNewMusicProfile(userId), { getAutoValues: false });\n      _accompanistProfiles.AccompanistProfiles.insert(createNewAccompanistProfile(userId), { getAutoValues: false });\n    }\n\n    return insertFullRandomProfile;\n  }(),\n\n  insertRandomData: function () {\n    function insertRandomData(number) {\n      for (var i = 0; i < number; i++) {\n        var genId = Random.id();\n        _basicProfiles.BasicProfiles.insert(createNewBasicProfile(genId), { getAutoValues: false });\n        _musicProfiles.MusicProfiles.insert(createNewMusicProfile(genId), { getAutoValues: false });\n        _accompanistProfiles.AccompanistProfiles.insert(createNewAccompanistProfile(genId), { getAutoValues: false });\n      }\n    }\n\n    return insertRandomData;\n  }()\n\n});\n\n// Server Side hooks\n\n_meteor.Meteor.users.after.insert(function (userId, doc) {\n  Roles.addUsersToRoles(this._id, 'makeBasicProfile');\n});\n\n// Basic Profiles Server Side Hooks\n\n_basicProfiles.BasicProfiles.before.insert(function (userId, doc) {\n  var loggedInUser = _meteor.Meteor.user();\n  if (!loggedInUser) {\n    throw new _meteor.Meteor.Error(403, \"Not Logged In\");\n  } else if (!Roles.userIsInRole(loggedInUser._id, 'makeBasicProfile')) {\n    throw new _meteor.Meteor.Error(403, \"No Permission to Make Basic Profile\");\n  }\n});\n\n_basicProfiles.BasicProfiles.after.insert(function (userId, doc) {\n  console.log(\"Basic Profile Made for\", doc.userId);\n  Roles.addUsersToRoles(doc.userId, 'makeMusicProfile');\n  Roles.addUsersToRoles(doc.userId, 'bookAccompanist');\n});\n\n// Music Profile Server Side Hooks\n\n_musicProfiles.MusicProfiles.before.insert(function (userId, doc) {\n  var loggedInUser = _meteor.Meteor.user();\n  if (!loggedInUser) {\n    throw new _meteor.Meteor.Error(403, \"Not Logged In\");\n  } else if (!Roles.userIsInRole(loggedInUser._id, 'makeMusicProfile')) {\n    throw new _meteor.Meteor.Error(403, \"No Permission to Make Music Profile\");\n  }\n});\n\n_musicProfiles.MusicProfiles.after.insert(function (userId, doc) {\n  Roles.addUsersToRoles(doc.userId, ['becomeAccompanist', 'musician']);\n});\n\n// Accompanist Profile Server Side Hooks\n\n_accompanistProfiles.AccompanistProfiles.before.insert(function (userId, doc) {\n  var loggedInUser = _meteor.Meteor.user();\n  if (!loggedInUser) {\n    throw new _meteor.Meteor.Error(403, \"Not Logged In\");\n  } else if (!Roles.userIsInRole(loggedInUser._id, 'becomeAccompanist')) {\n    throw new _meteor.Meteor.Error(403, \"Must first make Music Profile\");\n  }\n});\n\n_accompanistProfiles.AccompanistProfiles.after.insert(function (userId, doc) {\n  var address = doc.mylocation;\n  var coded = getGeocode(address);\n\n  var lat = Number(coded[0].latitude);\n  var lng = Number(coded[0].longitude);\n  var coords_new = [lng, lat];\n  console.log(\"working Insert\");\n  _accompanistProfiles.AccompanistProfiles.update({ _id: doc._id }, { $set: { geolocation: coded[0], loc: { 'type': \"Point\", 'coordinates': coords_new } } }, { getAutoValues: false });\n  Roles.addUsersToRoles(userId, 'accompanist');\n});\n\n_accompanistProfiles.AccompanistProfiles.after.update(function (userId, doc, fieldNames, modifier, options) {\n\n  var address = doc.mylocation;\n\n  // take if outside to make more efficient!!!!!\n  var result = getGeocode(address);\n\n  var lat = Number(result[0].latitude);\n  var lng = Number(result[0].longitude);\n  var coords_new = [lng, lat];\n  var coords_db = doc.loc.coordinates;\n\n  if (coords_new[0] !== coords_db[0] && coords_new[1] !== coords_db[1]) {\n    console.log(\"updating\");\n    _accompanistProfiles.AccompanistProfiles.update({ _id: doc._id }, { $set: { geolocation: result[0], loc: { 'type': \"Point\", 'coordinates': coords_new } } }, { getAutoValues: false });\n  }\n  console.log(\"working_UPDATE nothing done\");\n}, { fetchPrevious: true });","ast":null,"map":{"version":3,"sources":["/server/main.js"],"names":[],"mappings":"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","file":"/server/main.js.map","sourcesContent":["import { Meteor } from 'meteor/meteor';\nimport { BasicProfiles } from '../collections/basicProfiles.js'\nimport { MusicProfiles } from '../collections/musicProfiles.js'\nimport { AccompanistProfiles } from '../collections/accompanistProfiles.js'\n\nMeteor.startup(() => {\n\n});\n\nvar geo = new GeoCoder();\n\ngetGeocode = function(arg) {\n    var result = geo.geocode(arg);\n    return result\n}\n\nMeteor.methods({\n  getGeocode: function (arg) {\n    var result = geo.geocode(arg);\n    return result\n  },\n\n  insertFullRandomProfile: function(userId){\n    BasicProfiles.insert(createNewBasicProfile(userId), {getAutoValues: false});\n    MusicProfiles.insert(createNewMusicProfile(userId), {getAutoValues: false});\n    AccompanistProfiles.insert(createNewAccompanistProfile(userId), {getAutoValues: false});\n  },\n\n  insertRandomData: function(number) {\n    for (var i = 0; i < number; i++){\n      var genId = Random.id();\n      BasicProfiles.insert(createNewBasicProfile(genId), {getAutoValues: false});\n      MusicProfiles.insert(createNewMusicProfile(genId), {getAutoValues: false});\n      AccompanistProfiles.insert(createNewAccompanistProfile(genId), {getAutoValues: false});\n    }\n  }\n\n});\n\n// Server Side hooks\n\nMeteor.users.after.insert(function (userId, doc){\n  Roles.addUsersToRoles(this._id, 'makeBasicProfile');\n});\n\n// Basic Profiles Server Side Hooks\n\nBasicProfiles.before.insert(function (userId, doc){\n  var loggedInUser = Meteor.user();\n  if(!loggedInUser){\n    throw new Meteor.Error(403, \"Not Logged In\");\n  }else if(!Roles.userIsInRole(loggedInUser._id, 'makeBasicProfile')){\n    throw new Meteor.Error(403, \"No Permission to Make Basic Profile\");\n  }\n});\n\nBasicProfiles.after.insert(function(userId, doc){\n  console.log(\"Basic Profile Made for\",doc.userId);\n  Roles.addUsersToRoles(doc.userId, 'makeMusicProfile');\n  Roles.addUsersToRoles(doc.userId, 'bookAccompanist');\n});\n\n\n// Music Profile Server Side Hooks\n\nMusicProfiles.before.insert(function (userId, doc){\n  var loggedInUser = Meteor.user();\n  if(!loggedInUser){\n    throw new Meteor.Error(403, \"Not Logged In\");\n  }else if(!(Roles.userIsInRole(loggedInUser._id, 'makeMusicProfile'))){\n    throw new Meteor.Error(403, \"No Permission to Make Music Profile\");\n  }\n});\n\nMusicProfiles.after.insert(function(userId, doc){\n  Roles.addUsersToRoles(doc.userId, ['becomeAccompanist', 'musician']);\n});\n\n\n\n// Accompanist Profile Server Side Hooks\n\nAccompanistProfiles.before.insert(function (userId, doc){\n  var loggedInUser = Meteor.user();\n  if(!loggedInUser){\n    throw new Meteor.Error(403, \"Not Logged In\");\n  }else if(!Roles.userIsInRole(loggedInUser._id, 'becomeAccompanist')){\n    throw new Meteor.Error(403, \"Must first make Music Profile\");\n  }\n});\n\nAccompanistProfiles.after.insert(function (userId, doc) {\n  var address = doc.mylocation;\n  var coded = getGeocode(address);\n\n  var lat = Number(coded[0].latitude);\n  var lng = Number(coded[0].longitude);\n  var coords_new = [lng, lat];\n  console.log(\"working Insert\")\n  AccompanistProfiles.update({_id: doc._id}, {$set: {geolocation : coded[0], loc: {'type': \"Point\", 'coordinates' : coords_new}}},{getAutoValues: false});\n  Roles.addUsersToRoles(userId, 'accompanist');\n});\n\nAccompanistProfiles.after.update(function (userId, doc, fieldNames, modifier, options) {\n\n  var address = doc.mylocation;\n\n  // take if outside to make more efficient!!!!!\n  var result = getGeocode(address);\n\n  var lat = Number(result[0].latitude);\n  var lng = Number(result[0].longitude);\n  var coords_new = [lng, lat];\n  var coords_db = doc.loc.coordinates\n\n  if (coords_new[0] !== coords_db[0] && coords_new[1] !== coords_db[1]) {\n    console.log(\"updating\")\n    AccompanistProfiles.update({_id: doc._id}, {$set: {geolocation : result[0], loc: {'type': \"Point\", 'coordinates' : coords_new}}},\n                                {getAutoValues: false});\n  }\n  console.log(\"working_UPDATE nothing done\")\n\n}, {fetchPrevious: true});\n"]},"hash":"8655032a873c28e974f4415a0758bb31051d760e"}

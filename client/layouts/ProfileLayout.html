<!-- Profile Page Access Logic -->
<template name="ProfileLayout">
    <main>
      <div class="parallax-container">
        <!-- <div class="parallax"> -->
          <!-- {{#unless isOwnProfile}} -->
            <img class=" cover-picture" src="http://materializecss.com/images/parallax1.jpg" />
        <!--   {{else}}
              <img id="#cover-picture" class="modal-trigger change-cover-pic" href="#changeImageModal" src="http://materializecss.com/images/parallax1.jpg" /> -->
            <!-- <a class="btn waves-effect waves-light modal-trigger" href="#changeProfileModal">
              <i class="material-icons right">account_box</i>Add Picture<br><br><br><br>&nbsp;
            </a> -->
          <!-- {{/unless}} -->
        <!-- </div> -->
      </div>
      <!-- uncomment later on -->
          <!-- {{#if validId}} -->
            {{#if isOwnProfile}}
              <div class="row">
                <div class="col l8 m8 s12">
                  {{> Template.dynamic template="accountTemplate" data=myBasicProfile}}
                  {{#if userIsAccompanist}}
                    {{> Template.dynamic template="accompanistProfileTemplate" data=routeAccompanistProfile}}
                  {{/if}}
                  {{> Template.dynamic template="profileTemplate" data=myMusicProfile}}
                </div>
                <div class="col l4 m4 s12">
                  <div class="overlap-into-top">
                    <div class="card grey lighten-5 z-depth-0">
                      <div class="card-content">
                        <ul>
                          <li>
                            <h6><b><div class="center">Profile Strength</div></b></h6>
                            <br>
                            {{>liquid_fill_gauge}}
                            <br>
                            <br>
                          </li>
                          <li class="divider"></li>
                          <li>
                            <h6><b><div class="center">How to strengthen my Profile?</div></b></h6>
                            {{> suggestions}}
                          </li>
                          <li class="divider"></li>
                          <li>
                            <h6><b><div class="center">Accompanying data/advs to join</div></b></h6>
                          </li>
                      </ul>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            {{else}}
              {{#if isAccompanist}}
                <div class="row">
                  <div class="col s8">
                    {{> Template.dynamic template="accountTemplate" data=routeBasicProfile}}
                    {{> Template.dynamic template="accompanistProfileTemplate" data=routeAccompanistProfile}}
                    {{> Template.dynamic template="profileTemplate" data=routeMusicProfile}}
                  </div>
                  <div class="col s4">
                    <div class="overlap-into-top">
                      <div class="card grey lighten-5 z-depth-0">
                        <div class="card-content">
                          <h6><b><div class="center">Book This Accompanist</div></b></h6>
                            {{> bookAccompanistForm}}
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              {{else}}
                {{> Template.dynamic template="accountTemplate" data=routeBasicProfile}}
                {{> Template.dynamic template="profileTemplate" data=routeMusicProfile}}
              {{/if}}
            {{/if}}
         <!--  {{else}}
            {{> invalidId}}
          {{/if}} -->
    </main>
</template>

<template name="liquid_fill_gauge">
  <svg id="fillgauge2" width="100%" height="100%" ></svg>
</template>

<template name="suggestions">
  <div class="suggestions">
    <ul>
      {{#each suggestions}}
        <li>{{this}}</li>
      {{/each}}
      <br>
    </ul>
  </div>
</template>

<template name="bookAccompanistForm">
  {{#with routeAccompanist}}
    {{#autoForm id="bookAccompanistForm" collection="Transactions" type="insert" doc=partialTransaction}}
      {{> afQuickField name="musician" value=currentUser._id type="hidden"}}
      {{> afQuickField name="accompanist" value=this type="hidden"}}
      {{> afQuickField name="status" value="Pending" type="hidden"}}
      <!-- {{> afQuickField name="startDate"}}
      {{> afQuickField name="endDate"}} -->
      <label for="sd" class="active">Start Date</label>
      {{> afFieldInput name="startDate" id="sd" type="date"}}

       <label for="ed" class="active">End Date</label>
      {{> afFieldInput name="endDate" id="ed" type="date"}}

      <!--{{> afQuickField name="repertoire"}} -->
      {{> afArrayField name="repertoire" template="newAccompCustomArrayField" data="booking"}}
    {{/autoForm}}
    <div class="center"><button class="btn wave-light book-accompanist">Request To Book</button></div>
  {{else}}
    Not on an accompanist page.
  {{/with}}
</template>
<template name="invalidId">
  <h2>Invalid ID</h2>
</template>

<!-- SECTION: Basic Information Card -->
<template name="accountTemplate">
  <div id="first-card-container" class="card grey lighten-5 z-depth-0">
    <div id="first-card-text" class="card-content">
      <span class="black-text activator">
        <div class="all">
          <div id="profileImg">
            {{#unless isOwnProfile}}
              {{#with currentProfilePic}}
                <a class="waves-effect waves-light">
                  <img class="materialboxed" src={{currentProfilePic}}>
                </a>
              {{/with}}
            {{else}}
              {{#with currentProfilePic}}
                <a class="waves-effect waves-light modal-trigger change-profile-pic" href="#changeImageModal">
                  <img src={{this}} height="250px">
                </a>
              {{else}}
                <a class="btn waves-effect waves-light modal-trigger change-profile-pic" href="#changeImageModal">
                  <i class="material-icons right">account_box</i>Add Picture<br><br><br><br>&nbsp;
                </a>
              {{/with}}
            {{/unless}}
          </div>
          <!-- Modal to change profile pic -->
          {{> changeImageModal}}
        <!-- <span class="black-text activator"> -->
          <div class="details">
            <h5 class="bold">{{name}}</h5>
            <h6>{{affiliation}}</h6>
            {{#if isOwnProfile}}
            <h10>{{formatBirthDate this.birthDate}}</h10> <br>
            <h10>{{phone}}</h10> <br>
           <!--  <i class="material-icons right">mode_edit</i>
            <br> -->
            {{/if}}
          </div>
          {{#if isOwnProfile}}
          <i class="material-icons right">mode_edit</i>
          <br>
        {{/if}}
        </div>
      </span>
    </div>
    {{#if isOwnProfile}}
      <div class="card-reveal grey lighten-5 z-depth-0">
        <span class="card-title grey-text text-darken-4"><i class="material-icons right">close</i></span>
        {{> basicMyProfile}}
      </div>
    {{/if}}
  </div>
</template>

<template name="changeImageModal">
  <div id="changeImageModal" class="modal modal-fixed-footer white">
    <!-- <div class="modal-content"> -->
      <!-- <h5><i class="material-icons modal-action modal-close right">close</i></h5> -->
      <!-- {{> upload}} -->
      {{>picOverlord}}
    <!-- </div> -->
    <div class="modal-footer">
      <a href="#!" class="modal-action modal-close waves-effect waves-green btn-flat ">Close</a>
    </div>
  </div>
</template>

<!-- SECTION: MusicProfile Cards  -->

<!-- Wrapper -->
<template name="profileTemplate">
  <section class="myprofile">
    {{#each arrayProfileCards instruments awards musicPrograms orchestras}}
      <div class="card grey lighten-5 z-depth-0">
        <div class="card-content">
          <span class="black-text activator">
          <h5>
            <i id="align_text" class="medium material-icons">{{icon}}</i>
            {{mainTitle}}
          </h5>
          {{> UI.dynamic template=dynamicDataTemplate data=dynamicData}}
          {{#if notEmpty dynamicData}}
            {{#if isOwnProfile}}
              <i class="myprofile_edit material-icons right">mode_edit</i>
            {{/if}}
          {{/if}}
          <br>
         </span>
        </div>
        {{#if isOwnProfile}}
          <div class="card-reveal grey lighten-5 z-depth-0">
            <span class="card-title grey-text text-darken-4"><i class="material-icons right">close</i></span>
            {{> UI.dynamic template="EditingForm" data=arrayField}}
          </div>
        {{/if}}
      </div>
      {{#if isOwnProfile}}
          <div class="AddArrayObjectButton">
            <div class={{addButtonClass}}>
              <center>
                <button
                  type="button"
                  class="add-btn {{addButtonClass}} grey">
                  Add {{add_title}}
                </button>
              </center>
            </div>
          </div>
          <div class={{addArrayClass}}>
            <div class="card grey lighten-5 z-depth-0">
              <div class="card-content">
                <span class="{{close}} right"><i class="material-icons right">close</i> </span>
                {{#if notEmpty dynamicData}}
                  {{#autoForm id=arrayField type="update-pushArray" collection="MusicProfiles" doc=currentProfile scope=arrayField}}
                      {{> UI.dynamic template=arrayField data="myProfile"}}
                  {{/autoForm}}
                {{else}}
                  {{#autoForm collection="MusicProfiles" id="upsertMusicProfileForm" doc=currentProfile type=formType}}
                    {{> afArrayField name=arrayField template="firstCustomArrayField"}}

                      <button type="submit" class=" {{close}} btn right btn-primary">first</button>
                      <br>
                      <br>
                  {{/autoForm}}
                {{/if}}
              </div>
            </div>
          </div>
      {{/if}}
    {{/each}}
  </section>
</template>

<!-- Editing For (Except for Basic Profile info..aka first card in MyProfile) -->
<template name="EditingForm">
  {{#if isInRole 'makeMusicProfile'}}
    {{#autoForm collection="MusicProfiles" doc=currentProfile id="ArrayEditingForm" type=formType}}
      {{> afArrayField name=this template="editProfileCustomArrayField"}}
      <br>
    <button type="submit" class="card-title btn right btn-primary">Save</button>
    {{/autoForm}}
  {{/if}}
</template>

<template name="myProfileAccompEditingForm">
  {{#autoForm collection="AccompanistProfiles" doc=currentAccompanistProfiles id="myProfileAccompEditingForm" type="update"}}
    <h10>Hourly Charge</h10>
    {{> afQuickField name="charge"}}
    <h10>Prefered Working Hours</h10>
    {{> afQuickField name="working_hours"}}
    <h10>Prefered Working Days</h10>
    {{> afQuickField name="working_days"}}
    <h10>Activate Account?</h10>
    {{> afQuickField name="accompanist_active"}}
    <h10>Where would you prefer to accompany?</h10>
    {{> afQuickField name="session_location"}}
    <h10>Where are you?</h10>
    {{> afQuickField name="mylocation" class="autocomplete" id="autocomplete"}}
    <h10>Tell us something about yourself</h10>
    {{> afQuickField name="one_liner"}}
    <button type="submit" class=" btn card-title right btn-primary">Save</button>
  {{/autoForm}}
</template>

<template name="repertoireEditingForm">
  {{#autoForm collection="AccompanistProfiles" doc=currentAccompanistProfiles id="myProfileAccompEditingForm" type="update"}}
    {{> afArrayField name="repertoire" template="editProfileCustomArrayField"}}
    <button type="submit" class=" btn card-title right btn-primary">Save</button>
  {{/autoForm}}
</template>

<!-- SUB-SECTION: rendered data for each card -->

<template name="InstList">
  {{#each this}}
    <br>
    <h10>Instruments Mastered: {{this.instrument}}</h10> <br>
    <h10>Years Played: {{this.yearsPlayed}}</h10>
  {{/each}}
</template>

<template name="awardsList">
  {{#each this}}
    <span class="right">{{formatDate this.date}}</span>
    <p class="bold">{{name}}</p>
    {{award}}
    <br><br>
  {{/each}}
</template>

<template name="programsList">
  {{#each this}}
    <span class="right">{{formatDuration this.startDate this.endDate}}</span>
    {{programName}}
    <br><br>
  {{/each}}
</template>

<template name="orchestrasList">
  {{#each this}}
    <span class="right">{{formatDuration this.startDate this.endDate}}</span>
    <p class="bold">{{name}}</p>
    {{position}}
    <br><br>
  {{/each}}
</template>

<!-- END SECTION: MusicProfile Cards  -->

<!-- SECTION: Accompanist Profile Information Card -->
<template name="accompanistProfileTemplate">
  <div class="card {{accompColor accompanist_active}} z-depth-0">
    <div class="card-content">
      <span class="black-text activator">
        {{#if isOwnProfile}}
         <div class="row">
            <h5>
              Accompanying Preferances
            </h5>
          {{#autoForm collection="AccompanistProfiles" doc=currentAccompanistProfiles id="upsertAccompanistForm" type="update"}}
            {{> afQuickField name="charge" type="hidden"}}
            {{> afQuickField name="working_hours" type="hidden"}}
            {{> afQuickField name="working_days" type="hidden"}}
            {{> afQuickField name="session_location" type="hidden"}}
            {{> afQuickField name="mylocation" class="autocomplete" id="autocomplete" type="hidden"}}
            {{> afQuickField name="one_liner" type="hidden"}}
            
            <button type="submit" class="clean right">{{> afQuickField name="accompanist_active"}}</button>
            <!-- Switch -->
            <!-- <div class="switch">
              <label>
                Enactive
                <input type="checkbox">
                <span class="lever">{{> afQuickField name="accompanist_active"}}</span>
                Active
              </label>
            </div> -->


          {{/autoForm}}
          </div>
        {{/if}}
        <div class="accopmCard-left">
          <h10>
            <i id="align_text" class="small material-icons">attach_money</i>
            {{charge}}/hr
          </h10>
          <br>
          <h10>
              <i id="align_text" class="small material-icons">access_time</i>
              {{#each working_hours}}{{this}}/{{/each}}
          </h10>
        </div>
        <div class="accopmCard-right">
          <h10>
            <i id="align_text" class="small material-icons">event</i>
            {{#each working_days}}{{formatDay this}}/{{/each}}
          </h10>
          <br>
          <h10>
            <i id="align_text" class="small material-icons">location_on</i>
            {{mylocation}}
          </h10>
          <br><br>
        </div>
        <p class="center_horizontal">{{one_liner}}</p>
        {{#if isOwnProfile}}
            <br>
            <i class="material-icons right">mode_edit</i>
            <br>
        {{/if}}
      </span>
    </div>
         {{#if isOwnProfile}}
          <div class="card-reveal grey lighten-5 z-depth-0">
            <span class="card-title grey-text text-darken-4"><i class="material-icons right">close</i></span>
            {{> myProfileAccompEditingForm}}
          </div>
        {{/if}}
  </div>

{{#if isOwnProfile}}
  <div class="card grey lighten-5 z-depth-0">
    <div class="card-content">
      <span class="black-text activator">
        <h5>
        <i id="align_text" class="medium material-icons">clear_all</i>
        Repertoire
        </h5>
        {{#each repertoire}}
          {{concerto}}<br>
        {{/each}}
        <br>
        <i class="material-icons right">mode_edit</i>
        <br>
      </span>
    </div>
    <div class="card-reveal grey lighten-5 z-depth-0">
      <span class="card-title grey-text text-darken-4"><i class="material-icons right">close</i></span>
      {{> repertoireEditingForm}}
    </div>
  </div>

  <div class="AddArrayObjectButton">
    <div class="addRepButton">
      <center>
        <button
          type="button"
          class="add-btn grey">
          Add Repertoire
        </button>
      </center>
    </div>
  </div>
  <div class="addRepForm">
    <div class="card grey lighten-5 z-depth-0">
      <div class="card-content">
        <span class="cancel right"><i class="material-icons right">close</i> </span>
          {{#autoForm id="upsertRepertoireProfileForm" type="update-pushArray" collection="AccompanistProfiles" doc=currentAccompanistProfiles scope="repertoire"}}
            <div class="row">
              <br>
              <div class="input-field col s6">
                {{> afFieldInput name="concerto" id="rep" type="text"}}
                <label for="rep" class="active">Repertoire</label>
              </div>
              <button type="submit" class="cancel btn right btn-primary">test</button>
              <br>
            </div>
          {{/autoForm}}
      </div>
    </div>
  </div>

{{/if}}

</template>

<!-- ADD PIC PROFILE -->

<template name="upload">
    {{> uploader}}
    {{> files}}
</template>

<template name="files">
  <div class="files">
      {{#with profileFile}}
        {{>file}}
      {{else}}
        <p class="alert alert-warning">No files uploaded yet!</p>
      {{/with}}

  </div>
</template>

<template name="file">
  <div class="file">
    <div class="preview container center">
      <h5>Preview</h5>
      <a href="{{url}}" target="_blank"></a>
      {{#if isImage url}}
        <img src="{{url}}" alt="{{url}}" height="200px">
      {{else}}
        <i class="fa fa-file-o"></i>
      {{/if}}
    </div>
    <div class="delete center">
      <button class="btn waves-light red lighten-2 delete_button" value={{_id}}>Delete</button>
    </div>
  </div>
</template>

<template name="uploader">
  <div class="container">
    <p class="alert alert-success text-center">
      <span>Click Here to Upload</span>
    </p>
    <form action="#">
      <div class="file-field input-field">
        <div class="btn">
          <span>File</span>
          <input type="file">
        </div>
        <div class="file-path-wrapper">
          <input class="file-path validate" type="text">
        </div>
      </div>
    </form>
  </div>
</template>

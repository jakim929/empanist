<template name="ProfileLayout">

  <script>
    $(document).ready(function() {

    $(document).on('click.card', '.card', function (e) {
      if ($(this).find('> .card-reveal').length) {
        if ($(e.target).is($('.card-reveal .card-title')) || $(e.target).is($('.card-reveal .card-title i'))) {
          // Make Reveal animate down and display none
          $(this).find('.card-reveal').velocity(
            {translateY: 0}, {
              duration: 225,
              queue: false,
              easing: 'easeInOutQuad',
              complete: function() { $(this).css({ display: 'none'}); }
            }
          );
            $(this).velocity({height:$(this).data('height')},{duration:225});
        }
        else if ($(e.target).is($('.card .activator')) ||
                 $(e.target).is($('.card .activator i')) ) {
          $(e.target).closest('.card').css('overflow', 'hidden');
          $(this).data('height',$(this).css('height')).find('.card-reveal').css({ display: 'block',height:'auto'}).velocity("stop", false).velocity({translateY: '-100%'}, {duration: 300, queue: false, easing: 'easeInOutQuad'});
              $(this).velocity({height:$(this).find('.card-reveal').height()+40},{duration:300});
        }
      }
      $('.card-reveal').closest('.card').css('overflow', 'hidden');
    });
  });
  </script>

    <header>
        <h1> Profile </h1>
        <link rel="stylesheet" href="styles/custom.css">
    </header>
    <main>
      {{#if validId}}
        {{#if isOwnProfile}}
          {{> Template.dynamic template="accountTemplate" data=myBasicProfile}}
          {{> Template.dynamic template="profileTemplate" data=myMusicProfile}}<br>
        {{else}}
          {{#if routeAccompanistProfile}}
            {{> Template.dynamic template="accountTemplate" data=routeBasicProfile}} <br>
            {{> Template.dynamic template="accompanistProfileTemplate" data=routeAccompanistProfile}} <br>
            {{> Template.dynamic template="profileTemplate" data=routeMusicProfile}}<br>
            {{> bookAccompanist}}
          {{else}}
          {{> Template.dynamic template="accountTemplate" data=routeBasicProfile}}
          {{> Template.dynamic template="profileTemplate" data=routeMusicProfile}}<br>
          {{/if}}
        {{/if}}
      {{else}}
        {{> invalidId}}
      {{/if}}
    </main>
</template>

<template name="invalidId">
  <h2>Invalid ID</h2>
</template>


<template name="accountTemplate">
  <div class="card grey lighten-5 z-depth-1">
    <div class="card-content">
      <span class="black-text activator">
        <h10>{{name}}</h10><br>
        <h10>{{affiliation}}</h10> <br>

        {{#if isOwnProfile}}
        <h10>Birthday: {{birthDate}}</h10> <br>
        <h10>Phone Number: {{phone}}</h10> <br>
        <i class="material-icons right">mode_edit</i>
        <br>
        {{/if}}

      </span>
    </div>

    {{#if isOwnProfile}}
      <div class="card-reveal grey lighten-5 z-depth-1">
        <span class="card-title grey-text text-darken-4"><i class="material-icons right">close</i></span>
        {{> upsertBasicProfileForm}}
      </div>
    {{/if}}

  </div>
</template>


<template name="profileTemplate">
  <section class="myprofile">

        <div class="card grey lighten-5 z-depth-1">
          <div class="card-content">
            <span class="black-text activator">
              <h5>Instruments Mastered</h5> <br>
              <h10>Instruments Mastered: {{instrument}}</h10> <br>
              <h10>Years Played: {{yearsPlayed}}</h10>

               {{#if isOwnProfile}}
                  <i class="material-icons right">mode_edit</i>
                {{/if}}

           </span>
          </div>

          {{#if isOwnProfile}}
            <div class="card-reveal grey lighten-5 z-depth-1">
              <span class="card-title grey-text text-darken-4"><i class="material-icons right">close</i></span>
              {{> upsertInstrumentForm}}
            </div>
          {{/if}}

        </div>

        <div class="card grey lighten-5 z-depth-1">
          <div class="card-content">
            <span class="black-text activator">
            <h5>Awards: </h5>
            {{#each awards}}
              <span class="right">{{formatDate this.date}}</span>
              {{name}}
              <br><br>
            {{/each}}

            {{#if isOwnProfile}}
              <i class="material-icons right">mode_edit</i>
            {{/if}}
            <br>

           </span>
          </div>

          {{#if isOwnProfile}}
            <div class="card-reveal grey lighten-5 z-depth-1">
              <span class="card-title grey-text text-darken-4"><i class="material-icons right">close</i></span>
              {{> upsertAwardsForm}}
            </div>
          {{/if}}

        </div>

        <div class="card grey lighten-5 z-depth-1">
          <div class="card-content">
            <span class="black-text activator">
             <h5>Music Programs: </h5>
              {{#each musicPrograms}}
                <span class="right">{{formatDuration this.startDate this.endDate}}</span>
                {{programName}}<br>



                <br><br>
              {{/each}}

              {{#if isOwnProfile}}
                <i class="material-icons right">mode_edit</i>
              {{/if}}
              <br>

           </span>
          </div>

          {{#if isOwnProfile}}
            <div class="card-reveal grey lighten-5 z-depth-1">
              <span class="card-title grey-text text-darken-4"><i class="material-icons right">close</i></span>
              {{> upsertProgramsForm}}
            </div>
          {{/if}}

        </div>

        <div class="card grey lighten-5 z-depth-1">
          <div class="card-content">
            <span class="black-text activator">
            <h5>Orchestras Participated in: </h5>
              {{#each orchestras}}
                <span class="right">{{formatDuration this.startDate this.endDate}}</span>
                Name: {{name}}<br>
                Position: {{position}}<br>
                <br><br>
              {{/each}}

            {{#if isOwnProfile}}
              <i class="material-icons right">mode_edit</i>
            {{/if}}
            <br>

           </span>
          </div>

          {{#if isOwnProfile}}
            <div class="card-reveal grey lighten-5 z-depth-1">
              <span class="card-title grey-text text-darken-4"><i class="material-icons right">close</i></span>
              {{> upsertOrchestraForm}}
            </div>
          {{/if}}
        </div>

  </section>
</template>

<template name="accompanistProfileTemplate">
  <div class="card grey lighten-5 z-depth-1">
    <div class="card-content">
      <span class="black-text activator">
        <!--
        <h5>Repertoire: </h5>
        {{#each repertoire}}
          {{this}}<br>
        {{/each}}
           <hr> -->
        <h10>Hourly Rate: ${{charge}}</h10> <br>
        <h10>Preferred Working Time: {{#each working_hours}}{{this}}/{{/each}}</h10><br>
        <h10>Working Days: {{#each working_days}}{{this}}/{{/each}}</h10><br>
        <h10>Location: {{mylocation}}</h10><br>
        <h10>One Liner: {{one_liner}}</h10>
      </span>
    </div>
  </div>
</template>




<!-- template to edit/add instruments -->
<template name="upsertInstrumentForm">
  {{#if isInRole 'makeMusicProfile'}}
    {{#autoForm collection="MusicProfiles" doc=currentProfile id="upsertInstraForm" type=formType}}
      <fieldset>
        {{>afQuickField name="instrument" type="selectize" options=instrumentList }}
        {{>afQuickField name="yearsPlayed"}}
      </fieldset>
      <br>
    <button type="submit" class="btn btn-primary">Save</button>
    {{/autoForm}}
  {{/if}}
</template>

<!-- template to edit/add awards -->
<template name="upsertAwardsForm">
  {{#if isInRole 'makeMusicProfile'}}
    {{#autoForm collection="MusicProfiles" doc=currentProfile id="upsertAwardsForm" type=formType}}
      <fieldset>
        {{>afQuickField name="awards"}}
      </fieldset>
      <br>
    <button type="submit" class="btn btn-primary">Save</button>
    {{/autoForm}}
  {{/if}}
</template>

<!-- template to edit/add progs -->
<template name="upsertProgramsForm">
  {{#if isInRole 'makeMusicProfile'}}
    {{#autoForm collection="MusicProfiles" doc=currentProfile id="upsertProgramsForm" type=formType}}
      <fieldset>
        {{>afQuickField name="musicPrograms"}}
      </fieldset>
      <br>
    <button type="submit" class="btn btn-primary">Save</button>
    {{/autoForm}}
  {{/if}}
</template>

<!-- template to edit/add orchestra -->
<template name="upsertOrchestraForm">
  {{#if isInRole 'makeMusicProfile'}}
    {{#autoForm collection="MusicProfiles" doc=currentProfile id="upsertOrchestraForm" type=formType}}
      <fieldset>
        {{>afQuickField name="orchestras"}}
      </fieldset>
      <br>
    <button type="submit" class="btn btn-primary">{Save</button>
    {{/autoForm}}
  {{/if}}
</template>

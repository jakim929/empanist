<!-- Profile Page Access Logic -->
<template name="ProfileLayout">
    <main>
      <div class="parallax-container">
        <div class="parallax">
          <img src="http://materializecss.com/images/parallax1.jpg" />
        </div>
      </div>
          {{#if validId}}
            {{#if isOwnProfile}}
              {{> Template.dynamic template="accountTemplate" data=myBasicProfile}}
              {{> Template.dynamic template="profileTemplate" data=myMusicProfile}}
            {{else}}
              {{#if isAccompanist}}
              <div class="row">
                <div class="col s8">
                  {{> Template.dynamic template="accountTemplate" data=routeBasicProfile}}
                  {{> Template.dynamic template="accompanistProfileTemplate" data=routeAccompanistProfile}}
                  {{> Template.dynamic template="profileTemplate" data=routeMusicProfile}}
                </div>
                <div class="col s4">
                  <div class="overlap-into-top">
                    <div class="card grey lighten-5 z-depth-0">
                      <div class="card-content">
                        <h6><b><div class="center">Book This Accompanist</div></b></h6>
                          {{> bookAccompanistForm}}
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              {{else}}
                {{> Template.dynamic template="accountTemplate" data=routeBasicProfile}}
                {{> Template.dynamic template="profileTemplate" data=routeMusicProfile}}
              {{/if}}
            {{/if}}
          {{else}}
            {{> invalidId}}
          {{/if}}
    </main>
</template>

<template name="bookAccompanistForm">
  {{#with routeAccompanist}}
    {{#autoForm id="bookAccompanistForm" collection="Transactions" type="insert" doc=partialTransaction}}
      {{> afQuickField name="musician" }}
      {{> afQuickField name="accompanist" value=this type="hidden"}}
      {{> afQuickField name="status" value="Pending" type="hidden"}}
      {{> afQuickField name="startDate"}}
      {{> afQuickField name="endDate"}}
      <!--{{> afQuickField name="repertoire"}} -->
      {{> afArrayField name="repertoire" template="newAccompCustomArrayField" data="booking"}}
    {{/autoForm}}
    <div class="center"><button class="btn wave-light book-accompanist">Request To Book</button></div>
  {{else}}
    Not on an accompanist page.
  {{/with}}
</template>


<template name="invalidId">
  <h2>Invalid ID</h2>
</template>

<!-- SECTION: Basic Information Card -->
<template name="accountTemplate">
  <div id="first-card-container" class="card grey lighten-5 z-depth-0">
    <div id="first-card-text" class="card-content">
      <span class="black-text activator"> 
        <div class="all">
          <div id="profileImg">
            {{#unless isOwnProfile}}
              {{#with currentProfilePic}}
                <a class="waves-effect waves-light">
                  <img class="materialboxed" src={{currentProfilePic}}>
                </a>
              {{/with}}
            {{else}}
              {{#with currentProfilePic}}
                <a class="waves-effect waves-light modal-trigger" href="#changeProfileModal">
                  <img src={{this}} height="250px">
                </a>
              {{else}}
                <a class="btn waves-effect waves-light modal-trigger" href="#changeProfileModal">
                  <i class="material-icons right">account_box</i>Add Picture<br><br><br><br>&nbsp;
                </a>
              {{/with}}
            {{/unless}}
          </div>
          <!-- Modal to change profile pic -->
          <div id="changeProfileModal" class="modal">
            <div class="modal-content">
              <h5>Change Profile Picture <i class="material-icons modal-action modal-close right">close</i></h5>
              {{> upload}}
            </div>
          </div>
        <!-- <span class="black-text activator"> -->
          <div class="details">
            <h5 class="bold">{{name}}</h5>
            <h6>{{affiliation}}</h6>
            {{#if isOwnProfile}}
            <h10>{{formatBirthDate this.birthDate}}</h10> <br>
            <h10>{{phone}}</h10> <br>
           <!--  <i class="material-icons right">mode_edit</i>
            <br> -->
            {{/if}}
          </div>
          {{#if isOwnProfile}}
          <i class="material-icons right">mode_edit</i>
          <br>
        {{/if}}
        </div>
      </span>
    </div>
    {{#if isOwnProfile}}
      <div class="card-reveal grey lighten-5 z-depth-0">
        <span class="card-title grey-text text-darken-4"><i class="material-icons right">close</i></span>
        {{> basicMyProfile}}
      </div>
    {{/if}}
  </div>
</template>

<!-- SECTION: MusicProfile Cards  -->

<!-- Wrapper -->
<template name="profileTemplate">
  <section class="myprofile">
    {{#each arrayProfileCards instruments awards musicPrograms orchestras}}
      <div class="card grey lighten-5 z-depth-0">
        <div class="card-content">
          <span class="black-text activator">
          <h5>
            <i id="align_text" class="medium material-icons">{{icon}}</i>
            {{mainTitle}}
          </h5>
          {{> UI.dynamic template=dynamicDataTemplate data=dynamicData}}
          {{#if isOwnProfile}}
            <i class="material-icons right">mode_edit</i>
          {{/if}}
          <br>
         </span>
        </div>
        {{#if isOwnProfile}}
          <div class="card-reveal grey lighten-5 z-depth-0">
            <span class="card-title grey-text text-darken-4"><i class="material-icons right">close</i></span>
            {{> UI.dynamic template="EditingForm" data=arrayField}}
          </div>
        {{/if}}
      </div>
      {{#if isOwnProfile}}
        {{#if isArray status}}    
          <div class="AddArrayObjectButton">
            <div class={{addButtonClass}}>
              <center>
                <button
                  type="button"
                  class="add-btn {{addButtonClass}} grey">
                  Add {{add_title}}
                </button>
              </center>
            </div>
          </div>
          <div class={{addArrayClass}}>
            <div class="card grey lighten-5 z-depth-0">
              <div class="card-content">
                <span class="{{close}} right"><i class="material-icons right">close</i> </span>
                {{#autoForm id=arrayField type="update-pushArray" collection="MusicProfiles" doc=currentProfile scope=arrayField}}
                  {{> UI.dynamic template=arrayField data="myProfile"}}
                {{/autoForm}}
              </div>
            </div>
          </div>
        {{/if}}
      {{/if}}
    {{/each}}
  </section>
</template>

<!-- Editing For (Except for Basic Profile info..aka first card in MyProfile) -->
<template name="EditingForm">
  {{#if isInRole 'makeMusicProfile'}}
    {{#autoForm collection="MusicProfiles" doc=currentProfile id="ArrayEditingForm" type=formType}}
      {{> afArrayField name=this template="editProfileCustomArrayField"}}
      <br>
    <button type="submit" class="card-title btn right btn-primary">Save</button>
    <!-- <span class="card-title grey-text text-darken-4"><i class="material-icons right">close</i></span> -->
    {{/autoForm}}
  {{/if}}
</template>

<!-- SUB-SECTION: rendered data for each card -->

<template name="InstList">
  {{#each this}}
    <br>
    <h10>Instruments Mastered: {{this.instrument}}</h10> <br>
    <h10>Years Played: {{this.yearsPlayed}}</h10>
  {{/each}}
</template>

<template name="awardsList">
  {{#each this}}
    <span class="right">{{formatDate this.date}}</span>
    <p class="bold">{{name}}</p>
    {{award}}
    <br><br>
  {{/each}}
</template>

<template name="programsList">
  {{#each this}}
    <span class="right">{{formatDuration this.startDate this.endDate}}</span>
    {{programName}}
    <br><br>
  {{/each}}
</template>

<template name="orchestrasList">
  {{#each this}}
    <span class="right">{{formatDuration this.startDate this.endDate}}</span>
    <p class="bold">{{name}}</p>
    {{position}}
    <br><br>
  {{/each}}
</template>

<!-- END SECTION: MusicProfile Cards  -->

<!-- SECTION: Accompanist Profile Information Card -->
<template name="accompanistProfileTemplate">
  <div class="card grey lighten-5 z-depth-0">
    <div class="card-content">
      <span class="black-text activator">
        <!--
        <h5>Repertoire: </h5>
        {{#each repertoire}}
          {{this}}<br>
        {{/each}}
           <hr> -->
        <div class="accopmCard-left">
          <h10>
            <i id="align_text" class="small material-icons">attach_money</i>
            {{charge}}/hr
          </h10>
          <br>
          <h10>
              <i id="align_text" class="small material-icons">access_time</i>
              {{#each working_hours}}{{this}}/{{/each}}
          </h10>
        </div>
        <div class="accopmCard-right">
          <h10>
            <i id="align_text" class="small material-icons">event</i>
            {{#each working_days}}{{formatDay this}}/{{/each}}
          </h10>
          <br>
          <h10>
            <i id="align_text" class="small material-icons">location_on</i>
            {{mylocation}}
          </h10>
          <br><br>
        </div>
        <p class="center_horizontal">{{one_liner}}</p>
      </span>
    </div>
  </div>
</template>

<!-- ADD PIC PROFILE -->

<template name="upload">
  <fieldset>
    {{> uploader}}
    {{> files}}
  </fieldset>
</template>

<template name="files">
  <div class="files">
      {{#with profileFile}}
        {{>file}}
      {{else}}
        <p class="alert alert-warning">No files uploaded yet!</p>
      {{/with}}

  </div>
</template>

<template name="file">
  <div class="file">
    <div class="preview container center">
      <h5>Preview</h5>
      <a href="{{url}}" target="_blank"></a>
      {{#if isImage url}}
        <img src="{{url}}" alt="{{url}}" height="200px">
      {{else}}
        <i class="fa fa-file-o"></i>
      {{/if}}
    </div>
    <div class="delete center">
      <button class="btn waves-light red lighten-2 delete_button" value={{_id}}>Delete</button>
    </div>
  </div>
</template>

<template name="uploader">
  <div class="container">
    <p class="alert alert-success text-center">
      <span>Click Here to Upload</span>
    </p>
    <form action="#">
      <div class="file-field input-field">
        <div class="btn">
          <span>File</span>
          <input type="file">
        </div>
        <div class="file-path-wrapper">
          <input class="file-path validate" type="text">
        </div>
      </div>
    </form>
  </div>
</template>
